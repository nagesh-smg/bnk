// server.js

const express = require('express');
const session = require('express-session');
const MemoryStore = require('memorystore')(session);

const app = express();

// Middleware to parse incoming JSON request bodies
app.use(express.json());

// Session configuration using memorystore for production safety
app.use(session({
  secret: process.env.SESSION_SECRET || 'default_secret', // Use your own secure secret in production
  resave: false,
  saveUninitialized: true,
  cookie: { maxAge: 86400000 }, // 1 day in milliseconds
  store: new MemoryStore({
    checkPeriod: 86400000, // prune expired entries every 24h
  }),
}));

// Example route for GET request
app.get('/', (req, res) => {
  res.send('Hello World!');
});

// Example POST route to receive JSON data
app.post('/submit', (req, res) => {
  console.log('Received JSON data:', req.body); // req.body now contains parsed JSON
  res.json({ status: 'Success', received: req.body });
});

// Retrieve port and host from environment variables with defaults
const PORT = process.env.PORT || 5000;
const HOST = '127.0.0.1'; // Binding to localhost to avoid common Windows issues

// Start server with error handling
app.listen(PORT, HOST, () => {
  console.log(`Server listening on port ${PORT}`);
}).on('error', (error) => {
  console.error('Server failed to start:', error);
  process.exit(1); // exit with failure code
});


